# 31강 집합 연산

## 1) SQL과 집합
데이터베이스에서는 테이블의 행이 요소에 해당한다. 행은 여러 개의 열로 구성되는 경우도 있으므로 수치 상으로는 복수의 값이 존재한다.
하지만, 집합의 요소라는 측면에서 보면 하나의 행이 곧 하나의 요소가 된다. SELECT 명령을 실행하면 데이터베이스에 질의하여 그 결과 몇 개의 행이 반환된다.
이때 반환된 결과 전체를 하나의 집합이라고 생각하면 된다.

## 2) UNION으로 합집합 구하기
- union
SQL에서는 SELECT 명령의 실행 결과를 하나의 집합으로 다룰 수 있다.
합집합을 계산할 경우에는 UNION 키워드를 사용한다.

<img width="416" alt="스크린샷 2021-09-17 오전 11 42 33" src="https://user-images.githubusercontent.com/81137234/133715735-3be78162-86c8-4b95-b35b-55a8f91db7a2.png">
두 개의 select 명령을 하나의 명령으로 합치는 만큼, 세미콜론(;)은 맨 뒤에 붙인다.
만약 열 이름이 달라도 자료형이 같다면 일치하다고 말할 수 있고 합칠 수 있다.

<img width="474" alt="스크린샷 2021-09-17 오전 11 45 34" src="https://user-images.githubusercontent.com/81137234/133716050-1ba16a12-ef6e-41a9-b070-766d1f55f711.png">
select 명령은 union으로 묶을 때 나열 순서는 합집합의 결과에 영향을 주지 않는다.
단, 결과값의 나열 순서는 달라질 수 있다.

<img width="473" alt="스크린샷 2021-09-17 오전 11 47 39" src="https://user-images.githubusercontent.com/81137234/133716223-495771f1-a573-4df8-ae25-5912d9530edf.png">

order by를 지정할 수 있다고 해도 마지막의 select 명령의 결과만 정렬하는 것이 아니라 합집합의
결과를 정렬하기 때문에 에러가 발생할 수 있다. 이때 두 개의 select 명령에서 열 이름이
서로 일치한다면 문제가 없겠지만, 앞의 예제에서처럼 반드시 그렇다는 보장은 없다. 

<img width="470" alt="스크린샷 2021-09-17 오전 11 50 28" src="https://user-images.githubusercontent.com/81137234/133716444-51e24077-7094-4bf4-9937-096f6e5641e8.png">

이런 경우 별명을 붙여 정렬할 수 있다.

- union all

<img width="440" alt="스크린샷 2021-09-17 오전 11 55 54" src="https://user-images.githubusercontent.com/81137234/133716916-2bdad207-3a68-469a-b9c5-84f963f45d0c.png">

경우에 따라서는 중복을 제거하지 않고 2개의 select 명령의 결과를 합치고 싶을 수 있다.
이 경우 union all을 사용한다. union의 경우에는 기본 동작이 distinct이고 모든 결과를 얻고 싶을 때 all이다.

## 3) 교집합과 차집합
MySQL에서는 지원되지 않지만 intersect(교집합), except(차집합)이 존재합니다.

---

<br>

# 32강 테이블 결합

데이터베이스에서는 하나의 테이블에 많은 데이터를 저장하지 않고 몇 개의 테이블로 나누어 저장한다. 이처럼
여러개로 나뉜 데이터를 하나로 묶어 결과를 내는 방법이 테이블 결합이다.

## 1) 곱집합과 교차결합
두 개의 집합을 곱하는 연산 방법으로 적집합 또는 카티전곱(Cartesian product)이라고 부른다.

- 교차결합(cross join)

<img width="279" alt="스크린샷 2021-09-17 오전 11 59 59" src="https://user-images.githubusercontent.com/81137234/133717243-c4e32720-4c0c-4009-b89e-2de954d6afea.png">

테이블을 두 개 지정하면 이들은 곱집합으로 계산된다.

- union 연결과 결합 연결의 차이
from 구에서 복수의 테이블을 결합할 때도 새로 큰 집합을 만들어 계산한다.
비슷한 방식이지만 확대 방향이 다르다. union으로 합집합을 만드는 경우 `세로 방향`으로 더해진다.
from 구로 테이블을 결합할 경우에는 `가로 방향`으로 더해지게 된다.


## 2) 내부결합
집합은 중복된 값이 존재하지 않는다는 뜻이 포함되어 있다. 관계형 데이터베이스에서도 테이블의 데이터가
유일한 값을 가지는 것을 권장한다. 기본키를 가지는 것이 좋다는 뜻이다.
기본키란 하나의 데이터행을 대표할 수 있는 속성을 가진다.

<img width="779" alt="스크린샷 2021-09-17 오후 12 12 03" src="https://user-images.githubusercontent.com/81137234/133718238-6828cb60-fa4d-4f56-b7f4-62b2dc3248a0.png">

이렇게 만들어진 집합에서 원하는 데이터를 검색하기 위해 where 구로 조건을 지정한다.

<img width="775" alt="스크린샷 2021-09-17 오후 12 13 17" src="https://user-images.githubusercontent.com/81137234/133718368-fd02dfa9-6ec9-4f7f-8ac0-90a8e00c07bc.png">

상품 테이블의 상품코드 열은 `상품.상품코드`로 재고수 테이블의 상품코드 열은 `재고수.상품코드`로 지정한다.
교차결합으로 계산된 곱집합에서 원하는 조합을 검색하는 것을 내부결합이라고 부른다.

<img width="782" alt="스크린샷 2021-09-17 오후 12 15 46" src="https://user-images.githubusercontent.com/81137234/133718566-6f29eb61-6d20-48d2-8edd-7fdeebb42635.png">

where 구에는 두 개의 조건식이 지정되어 있다. 첫 번째 조건식은 교차결합으로 계산된 곱집합에서
원하는 조합을 검색하는 것이다. 두 번째 조건식은 결합 조건이 아닌 검색 조건이다.
첫번째 조건식의 조건을 `결합조건`이라고 한다.

## 3) inner join으로 내부결합하기

<img width="772" alt="스크린샷 2021-09-17 오후 12 18 20" src="https://user-images.githubusercontent.com/81137234/133718764-314d24d7-f3b0-43ce-8b6e-f35f050c5b37.png">

inner join은 내부 결합이라는 의미이다. inner join 은 `on` 명령어를 사용해 결합조건을 지정한다.

## 4) 내부 결합을 활용한 데이터 관리

- 외부키
외부키는 다른 테이블의 기본키를 참조하는 열이 외부키이다.

- 자기결합(self join)
자기결합에서는 결합의 좌우가 같은 테이블이 되기 때문에 이를 구별하기 위해 별명이 필수이다.

## 5) 외부결합
외부결합은 결합하는 테이블 중에 어느 쪽을 기준으로 할지 결정할 수 있다. inner join, left join 등 선택할
수 있다.

---

<br>

# 33강 관계형 모델

## 1) 관계형 모델
관계형 모델의 기본적인 요소는 `Relation`이다.
SQL에서는 테이블에 해당한다.

릴레이션에는 몇 가지 `속성(attribute)`가 있다. 이 속성은 속성 이름과 형 이름으로 구성된다.
SQL에서는 열에 해당한다.

- 하나 이상의 관계를 바탕으로 연산
- 연산한 결과, 반환되는 것 또한 관계이다
- 연산을 중첩 구조로 실행해도 상관없다.

## 2) 관계형 모델과 SQL
- union
릴레이션끼리 덧셈을 말한다.

- difference
릴레이션끼리 뺄셈을 말한다.

- intersection
릴레이션끼리의 공통 부분(교집합)을 말한다.

- cartesian product
SQL에서 FROM 구에 복수의 테이블을 지정한 경우 곱집합으로 계산된다.
`CROSS JOIN`으로 교차결합을 하면 곱집합을 구할 수 있다.

- selection
튜플의 추출을 말한다. 선택은 제한이라고 불리기도 한다.
SQL에서 행을 말하며, where 구에 조건을 지정해 데이터를 검색하는 것에 해당한다.

- projection
속성의 추출을 말한다.
SQL에서 속성은 열을 말하며, select 구에 결과로 반환할 열을 지정하는 것에 해당한다.

- join
릴레이션끼리 교차결합해 계산된 곱집합에서 결합조건을 만족하는 튜플을 추출하는 연산이다.
SQL에서는 내부결합에 해당한다. 관계대수에도 내부결합과 외부결합이 있다.

<br>